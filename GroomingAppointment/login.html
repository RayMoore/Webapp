<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="assets/bootstrap3/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/bootstrap3/css/bootstrap-theme.min.css" rel="stylesheet" />
  <link href="assets/css/mystyle.css" rel="stylesheet" />
  <link href="assets/web-fonts-with-css/css/fontawesome-all.css" rel="stylesheet">
  <link href="assets/bootstrap3/css/bootstrap-social.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-2.1.3.js"></script>
  <script src="assets/bootstrap3/js/bootstrap.js"></script>
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <link rel="shortcut icon" href="assets/webImage/titleImage.jpg" />
  <title>Grooming</title>
</head>
<body>
  <!-- navigation bar -->
  <nav id="navigationBar" class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img id="websiteLogo" src="assets/webImage/titleImage.jpg" /></span></a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html"><span class="glyphicon glyphicon-home"
                         aria-hidden="true"></span> Home</a></li>
          <li><a href="appointment.html"><span class="glyphicon glyphicon-th"
                         aria-hidden="true"></span> Appointment</a></li>
          <li><a href="about.html"><span class="glyphicon glyphicon-info-sign"
                         aria-hidden="true"></span> About</a></li>
          <li><a href="contact.html"><span class="glyphicon glyphicon-phone"
                         aria-hidden="true"></span> Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container" style="width:50%; margin-top:20px;">
    <form role="form" method="post">
      <div class="form-group">
        <label for="usr">Email:</label>
        <input type="text" class="form-control" name="email" id="loginEmail">
      </div>
      <div class="form-group">
        <label for="pwd">Password:</label>
        <input type="password" class="form-control" name="password" id="loginPassword" style="margin-bottom:10px;">
        <span style="text-decoration: underline;">forgot your password?</span>
      </div>
      <button id="loginBtn" type="submit" class="btn btn-primary"><span id="loginBtnIcon" class="glyphicon"></span> Login </button>
    </form>
  <div>

  <div class="container" style="margin-bottom:20px; margin-top:20px;">
      <p>
      <span style="font-weight: bold;">Or login with:  </span>
      <a class="btn btn-social-icon btn-google-plus" href="http://google.com/+"><i class="fab fa-google-plus"></i></a>
      <a class="btn btn-social-icon btn-facebook" href="http://www.facebook.com/profile.php?id="><i class="fab fa-facebook"></i></a>
      <a class="btn btn-social-icon btn-linkedin" href="http://www.linkedin.com/in/"><i class="fab fa-linkedin"></i></a>
      <a class="btn btn-social-icon btn-twitter" href="http://twitter.com/"><i class="fab fa-twitter"></i></a>
      </p>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script>
    var loginButton = document.getElementById('loginBtn');
    var loginEmail = document.getElementById('loginEmail');
    var loginBtnIcon = document.getElementById('loginBtnIcon');
    var loginPassword = document.getElementById('loginPassword');

    loginButton.onclick = function(){
      var userJson = {};
      userJson.loginEmail = document.getElementsByName('loginEmail')[0].value;
      userJson.loginPassword = document.getElementsByName('loginPassword')[0].value;
      ajax({
        trigger: [loginButton, loginEmail, loginPassword, loginBtnIcon],
        method: 'post',
        url: '/login',
        data: JSON.stringify(userJson),
        contentType: "application/json",
        callbackFunction: function(trigger, feedback){
          if(feedback.status === 0){
            // didn't match password or email address
            console.log(feedback.message);
            inputFieldValid(trigger[1], feedback);
            inputFieldValid(trigger[2], feedback);
          }else if(feedback.status === 1){
            //register successfully, but not active
            console.log(feedback.message);
            optSuccess(trigger[0], trigger[3], feedback);
            setTimeout("javascript:location.href='index.html'", 2000);
          }else if(feedback.status === 2){
            console.log(feedback.message);
            inputFieldValid(trigger[1], feedback);
            resendEmail(trigger[0], userJson.loginEmail);
          }
        },
        sendListener: function(trigger, data){
          trigger[0].disabled = true;
        },
        receiverListener: function(trigger, feedback, callbackFunction){
          trigger[0].disabled = false;
          return callbackFunction(trigger, feedback);
        }
      });
    }


    function resendEmail(btn, userEmail){
      var messageNode = document.createElement("A");
      messageNode.style.paddingLeft = "10px";
      messageNode.innerText = "click here to resend email activation link.";
      btn.parentNode.appendChild(messageNode);
      messageNode.onclick = function(){
        messageNode.disabled = true;
        messageNode.innerText = "resend activation link after 60 seconds."
        ajax({
          trigger:[],
          method: 'get',
          url: '/resend',
          data: "email=" + userEmail,
          contentType: '',
          callbackFunction:null,
          sendListener:null,
          receiverListener:null,
        })
        setTimeout(function(){
          messageNode.disabled = false;
          messageNode.innerText = "click here to resend email activation link."
        }, 60000);
      }
    }


    function inputFieldValid(someTrigger, feedback){
      someTrigger.parentNode.classList.add("has-error");
      var messageNode = document.createElement("SPAN");
      messageNode.style.paddingLeft = "5px";
      messageNode.style.color = "red";
      messageNode.innerText = feedback.message;
      someTrigger.parentNode.appendChild(messageNode);
    }

    function optSuccess(someTrigger, someBtnIcon, feedback){
      someBtnIcon.classList.add("glyphicon-ok");
      someTrigger.classList.remove("btn-primary");
      someTrigger.classList.add("btn-success");
      var messageNode = document.createElement("SPAN");
      messageNode.style.paddingLeft = "10px";
      messageNode.style.color = "green";
      messageNode.innerText = feedback.message;
      someTrigger.parentNode.appendChild(messageNode);
      // someTrigger.disabled = true;
    }

    loginEmail.onchange = function(){
      inputFieldOnchange(loginEmail, loginButton);
    }

    loginPassword.onchange = function(){
      inputFieldOnchange(loginPassword, loginButton);
    }

    function inputFieldOnchange(someInputField, someButton){
      someInputField.parentNode.classList.remove("has-error");
      if(someInputField.nextSibling){
        someInputField.parentNode.removeChild(someInputField.nextSibling);
      }
      if(someButton.nextSibling){
        someButton.classList.remove("glyphicon-ok");
        someButton.classList.add("btn-primary");
        someButton.classList.remove("btn-success");
        someButton.parentNode.removeChild(someButton.nextSibling);
        someButton.disabled = false;
      }
    }
  </script>
</body>
</html>
